# Requirements Document

## Introduction

The Copyright Detector is an AI-powered content moderation system that detects potential copyright infringement by comparing uploaded media (images and videos) against a database of known copyrighted content. The system uses vector embeddings and cosine similarity matching via pgvector to identify similar content, supporting AVIF images and MP4 video frame extraction.

## Glossary

- **Copyright Detector**: The system that processes uploaded media and checks for similarity against copyrighted content
- **Embedding**: A numerical vector representation of an image generated by a machine learning model (CLIP or Gemini)
- **pgvector**: A PostgreSQL extension enabling vector similarity search operations
- **Cosine Similarity**: A metric measuring the cosine of the angle between two vectors, used to determine content similarity
- **AVIF**: AV1 Image File Format, a modern image format requiring conversion for processing
- **Key Frame**: A representative frame extracted from a video at specific timestamps for analysis
- **Similarity Threshold**: The minimum similarity score (0.85 or 85%) above which content is flagged as potentially infringing
- **CLIP**: Contrastive Language-Image Pre-training model that generates multimodal embeddings

## Requirements

### Requirement 1

**User Story:** As a content moderator, I want to upload images in various formats including AVIF, so that I can check any image type for copyright infringement.

#### Acceptance Criteria

1. WHEN a user uploads an image file THEN the Copyright Detector SHALL accept JPEG, PNG, WebP, and AVIF formats
2. WHEN the Copyright Detector receives an AVIF image THEN the Copyright Detector SHALL convert the image to JPEG format for processing
3. WHEN processing an uploaded image THEN the Copyright Detector SHALL resize the image to a maximum of 512x512 pixels while maintaining aspect ratio
4. IF an uploaded file has an unsupported format THEN the Copyright Detector SHALL return an error message specifying accepted formats

### Requirement 2

**User Story:** As a content moderator, I want to upload video files and have key frames analyzed, so that I can detect copyrighted content within videos.

#### Acceptance Criteria

1. WHEN a user uploads an MP4 video file THEN the Copyright Detector SHALL extract five key frames at 10%, 30%, 50%, 70%, and 90% timestamps
2. WHEN extracting video frames THEN the Copyright Detector SHALL resize each frame to 512 pixels width while maintaining aspect ratio
3. WHEN video frame extraction completes THEN the Copyright Detector SHALL process each frame through the embedding pipeline
4. IF video frame extraction fails THEN the Copyright Detector SHALL return an error message with the failure reason

### Requirement 3

**User Story:** As a content moderator, I want uploaded content compared against a database of copyrighted material, so that I can identify potential infringement.

#### Acceptance Criteria

1. WHEN an image is processed THEN the Copyright Detector SHALL generate a vector embedding using the configured embedding model
2. WHEN an embedding is generated THEN the Copyright Detector SHALL query the pgvector database using cosine similarity
3. WHEN similarity results are retrieved THEN the Copyright Detector SHALL return matches with similarity scores above 0.85 (85%)
4. WHEN multiple matches exist THEN the Copyright Detector SHALL return the top three matches ordered by similarity score descending
5. WHEN serializing embeddings for storage THEN the Copyright Detector SHALL encode vectors as JSON arrays
6. WHEN deserializing embeddings from storage THEN the Copyright Detector SHALL parse JSON arrays back to vector format

### Requirement 4

**User Story:** As a content moderator, I want to see clear results indicating whether content is flagged or safe, so that I can take appropriate action.

#### Acceptance Criteria

1. WHEN the highest similarity match exceeds 0.85 THEN the Copyright Detector SHALL return a status of "flagged"
2. WHEN no similarity match exceeds 0.85 THEN the Copyright Detector SHALL return a status of "safe"
3. WHEN returning results THEN the Copyright Detector SHALL include the processing time in seconds
4. WHEN matches are found THEN the Copyright Detector SHALL include the matched filename and similarity percentage for each match

### Requirement 5

**User Story:** As a system administrator, I want to seed the database with known copyrighted content, so that the system has reference material for comparison.

#### Acceptance Criteria

1. WHEN the seed script runs THEN the Copyright Detector SHALL read all image files from the copyrighted-content directory
2. WHEN processing seed content THEN the Copyright Detector SHALL generate embeddings and store them with filename and content type
3. WHEN storing embeddings THEN the Copyright Detector SHALL use the pgvector VECTOR type with appropriate dimensions for the embedding model
4. WHEN the database is initialized THEN the Copyright Detector SHALL create an HNSW index on the embedding column for fast similarity search

### Requirement 6

**User Story:** As a user, I want a simple web interface to upload files and view results, so that I can easily check content for copyright issues.

#### Acceptance Criteria

1. WHEN a user visits the application THEN the Copyright Detector SHALL display a file upload interface accepting images and videos
2. WHEN a user submits a file THEN the Copyright Detector SHALL display a loading indicator during processing
3. WHEN results are returned THEN the Copyright Detector SHALL display the status with appropriate visual styling (red for flagged, green for safe)
4. WHEN matches are found THEN the Copyright Detector SHALL display each match with filename and similarity percentage

### Requirement 7

**User Story:** As a developer, I want the system containerized with Docker, so that it can be easily deployed and run consistently across environments.

#### Acceptance Criteria

1. WHEN docker-compose is executed THEN the Copyright Detector SHALL start PostgreSQL with pgvector extension and the application server
2. WHEN the application container builds THEN the Copyright Detector SHALL include FFmpeg for video processing
3. WHEN the application starts THEN the Copyright Detector SHALL connect to PostgreSQL and initialize the database schema
4. WHEN environment variables are configured THEN the Copyright Detector SHALL use DATABASE_URL for PostgreSQL connection and API keys for embedding services
