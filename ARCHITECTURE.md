# Architecture Diagram

## System Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           COPYRIGHT DETECTOR SYSTEM                          │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │    USER         │
                              │  (Browser)      │
                              └────────┬────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                            NEXT.JS FRONTEND (:3000)                          │
│  ┌────────────────────┐    ┌────────────────────┐    ┌──────────────────┐   │
│  │   FileUpload.tsx   │───►│   /api/upload      │───►│ ResultsDisplay   │   │
│  │   (Drag & Drop)    │    │   (Proxy Route)    │    │ (Status + Match) │   │
│  └────────────────────┘    └─────────┬──────────┘    └──────────────────┘   │
└──────────────────────────────────────┼───────────────────────────────────────┘
                                       │ POST /upload
                                       │ multipart/form-data
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                          EXPRESS.JS BACKEND (:3001)                          │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │                         POST /upload Handler                            │ │
│  │                                                                         │ │
│  │   1. Receive file (multer)                                              │ │
│  │   2. Detect type (image/video)                                          │ │
│  │   3. Route to processor                                                 │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                    │                              │                          │
│          ┌────────▼────────┐           ┌────────▼────────┐                  │
│          │ IMAGE PROCESSOR │           │ VIDEO PROCESSOR │                  │
│          │    (Sharp)      │           │    (FFmpeg)     │                  │
│          │                 │           │                 │                  │
│          │ • Validate fmt  │           │ • Get duration  │                  │
│          │ • AVIF → JPEG   │           │ • Extract 5     │                  │
│          │ • Resize 512x512│           │   key frames    │                  │
│          │ • Quality 90%   │           │ • Resize 512px  │                  │
│          └────────┬────────┘           └────────┬────────┘                  │
│                   │                             │                            │
│                   └──────────┬──────────────────┘                            │
│                              ▼                                               │
│                   ┌─────────────────────┐                                    │
│                   │  EMBEDDING SERVICE  │                                    │
│                   │   (Gemini API)      │                                    │
│                   │                     │                                    │
│                   │ • Base64 encode     │                                    │
│                   │ • Call Gemini       │                                    │
│                   │ • Return 768-dim    │                                    │
│                   │   vector            │                                    │
│                   └──────────┬──────────┘                                    │
│                              │                                               │
│                              ▼                                               │
│                   ┌─────────────────────┐                                    │
│                   │ SIMILARITY CHECKER  │                                    │
│                   │                     │                                    │
│                   │ • Query pgvector    │                                    │
│                   │ • Cosine distance   │                                    │
│                   │ • Filter > 85%      │                                    │
│                   │ • Return top 3      │                                    │
│                   └──────────┬──────────┘                                    │
│                              │                                               │
└──────────────────────────────┼───────────────────────────────────────────────┘
                               │
                               ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                      POSTGRESQL + PGVECTOR (:5432)                           │
│                                                                              │
│   ┌────────────────────────────────────────────────────────────────────┐    │
│   │                    copyrighted_content TABLE                        │    │
│   │                                                                     │    │
│   │   id │ filename      │ embedding (VECTOR 768) │ content_type │ ... │    │
│   │   ───┼───────────────┼────────────────────────┼──────────────┼──── │    │
│   │   1  │ sample1.jpg   │ [0.12, -0.34, ...]     │ image        │     │    │
│   │   2  │ sample2.png   │ [0.56, 0.78, ...]      │ image        │     │    │
│   │   3  │ frame_0.jpg   │ [-0.23, 0.45, ...]     │ video_frame  │     │    │
│   └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
│   ┌────────────────────────────────────────────────────────────────────┐    │
│   │                         HNSW INDEX                                  │    │
│   │              (Fast Approximate Nearest Neighbor Search)             │    │
│   └────────────────────────────────────────────────────────────────────┘    │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘


## Data Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              REQUEST FLOW                                    │
└─────────────────────────────────────────────────────────────────────────────┘

  ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
  │ UPLOAD  │      │ PROCESS │      │  EMBED  │      │ SEARCH  │      │ RESULT  │
  │         │      │         │      │         │      │         │      │         │
  │ Image   │─────►│ Sharp   │─────►│ Gemini  │─────►│pgvector │─────►│ JSON    │
  │   or    │      │   or    │      │  API    │      │ cosine  │      │response │
  │ Video   │      │ FFmpeg  │      │         │      │ search  │      │         │
  └─────────┘      └─────────┘      └─────────┘      └─────────┘      └─────────┘
       │                │                │                │                │
       │                │                │                │                │
       ▼                ▼                ▼                ▼                ▼
  ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐
  │ JPEG    │      │ JPEG    │      │ 768-dim │      │ Top 3   │      │ status: │
  │ PNG     │      │ buffer  │      │ float   │      │ matches │      │ flagged │
  │ WebP    │      │ 512x512 │      │ vector  │      │ >85%    │      │   or    │
  │ AVIF    │      │ max     │      │         │      │         │      │  safe   │
  │ MP4     │      │         │      │         │      │         │      │         │
  └─────────┘      └─────────┘      └─────────┘      └─────────┘      └─────────┘
```


## GCP Production Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         GCP DEPLOYMENT ARCHITECTURE                          │
└─────────────────────────────────────────────────────────────────────────────┘

                              ┌─────────────────┐
                              │     USERS       │
                              └────────┬────────┘
                                       │ HTTPS
                                       ▼
                              ┌─────────────────┐
                              │  Cloud Load     │
                              │   Balancer      │
                              │  (Global L7)    │
                              └────────┬────────┘
                                       │
                    ┌──────────────────┼──────────────────┐
                    │                  │                  │
                    ▼                  ▼                  ▼
           ┌───────────────┐  ┌───────────────┐  ┌───────────────┐
           │  Cloud Run    │  │  Cloud Run    │  │  Cloud Run    │
           │  Instance 1   │  │  Instance 2   │  │  Instance N   │
           │  (auto-scale) │  │  (auto-scale) │  │  (auto-scale) │
           └───────┬───────┘  └───────┬───────┘  └───────┬───────┘
                   │                  │                  │
                   └──────────────────┼──────────────────┘
                                      │
                    ┌─────────────────┼─────────────────┐
                    │                 │                 │
                    ▼                 ▼                 ▼
           ┌───────────────┐  ┌───────────────┐  ┌───────────────┐
           │ Cloud Storage │  │   Pub/Sub     │  │   Cloud SQL   │
           │  (uploads)    │  │   (queue)     │  │  PostgreSQL   │
           │               │  │               │  │  + pgvector   │
           └───────────────┘  └───────┬───────┘  └───────────────┘
                                      │
                                      ▼
                              ┌───────────────┐
                              │  Cloud Run    │
                              │   Workers     │
                              │ (processing)  │
                              └───────────────┘

Benefits:
• Auto-scaling (0 to N instances)
• Pay-per-use pricing
• Managed PostgreSQL with backups
• Global CDN for static assets
• Async processing via Pub/Sub
```
